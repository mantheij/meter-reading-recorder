#!/usr/bin/env bash
# Pre-commit hook: block commits containing Firebase secrets
set -euo pipefail

# Block GoogleService-Info plist files from being committed
BLOCKED_FILES=$(git diff --cached --name-only | grep -i 'GoogleService-Info.*\.plist$' | grep -v '\.template$' || true)
if [ -n "$BLOCKED_FILES" ]; then
  echo "ERROR: Attempting to commit Firebase config files containing secrets:"
  echo "$BLOCKED_FILES"
  echo ""
  echo "These files are in .gitignore for a reason. Remove them from staging:"
  echo "  git reset HEAD <file>"
  exit 1
fi

# Block Google API key patterns in staged files
API_KEY_PATTERN='AIzaSy[0-9A-Za-z_-]{33}'
MATCHES=$(git diff --cached -U0 | grep -oE "$API_KEY_PATTERN" || true)
if [ -n "$MATCHES" ]; then
  echo "ERROR: Found Google API key pattern in staged changes:"
  echo "$MATCHES"
  echo ""
  echo "Do not commit API keys. Use environment variables or secrets management instead."
  exit 1
fi
